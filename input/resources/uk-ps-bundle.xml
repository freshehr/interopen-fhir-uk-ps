<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="uk-ps-bundle"/>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-fmm">
    <valueInteger value="1"/>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-compliesWithProfile">
    <valueCanonical value="http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips"/>
  </extension>
  <url value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-bundle"/>
  <jurisdiction>
    <coding>
      <system value="urn:iso:std:iso:3166"/>
      <code value="GB"/>
    </coding>
  </jurisdiction>
  <name value="UKPSBundle"/>
  <title value="UK PS Bundle"/>
  <status value="draft"/>
  <description value="This profile sets minimum expectations for a Bundle resource in the context of a patient summary in a UK context. It is based on FHIR [Bundle](http://hl7.org/fhir/StructureDefinition/Bundle), and applies the constraints of [Bundle (IPS)](http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips) and UK Patient Summary (UK PS).&#xD;&#xA;UK PS is specified in this guide as a HL7 FHIR document (a Bundle including a Composition), composed by a set of potentially reusable 'minimal' data blocks (the UK PS profiles)."/>
  <kind value="resource"/>
  <abstract value="false"/>
  <type value="Bundle"/>
  <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
  <derivation value="constraint"/>
  <differential>
    <element id="Bundle">
        <path value="Bundle"/>
        <short value="UK Patient Summary Bundle"/>
        <definition value="UK Patient Summary Bundle. A container for a collection of resources in the patient summary document in a UK healthcare context."/>
        <constraint>
          <key value="bdl-ips-1"/>
          <severity value="error"/>
          <human value="An IPS document must have no additional Composition (including Composition subclass) resources besides the first."/>
          <expression value="entry.tail().where(resource is Composition).empty()"/>
        </constraint>
    </element>
    <element id="Bundle.identifier">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.identifier"/>
      <min value="1"/>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.type">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.type"/>
      <fixedCode value="document"/>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.timestamp">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.timestamp"/>
      <min value="1"/>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.entry">
      <path value="Bundle.entry"/>
      <slicing>
        <discriminator>
          <type value="type"/>
          <path value="resource"/>
        </discriminator>
        <rules value="open"/>
      </slicing>
      <short value="Entry resource in the patient summary bundle"/>
      <definition value="An entry resource included in the patient summary document bundle resource."/>
      <comment value="The Composition is the first entry (only a single Composition resource instance can be included) and a Patient resource.  Additional constraints are specified in the AU PS Composition profile."/>
      <min value="2"/>
    </element>
    <element id="Bundle.entry.fullUrl">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:able-to-populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.entry.fullUrl"/>
      <min value="1"/>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.entry.search">
      <path value="Bundle.entry.search"/>
      <max value="0"/>
    </element>
    <element id="Bundle.entry.request">
      <path value="Bundle.entry.request"/>
      <max value="0"/>
    </element>
    <element id="Bundle.entry.response">
      <path value="Bundle.entry.response"/>
      <max value="0"/>
    </element>
    <element id="Bundle.entry:composition">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHOULD:display"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.entry"/>
      <sliceName value="composition"/>
      <min value="1"/>
      <max value="1"/>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.entry:composition.resource">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Composition"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-composition"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.entry:patient">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.entry"/>
      <sliceName value="patient"/>
      <min value="1"/>
      <max value="1"/>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.entry:patient.resource">
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:populate"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-producer"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/obligation">
        <extension url="code">
          <valueCode value="SHALL:handle"/>
        </extension>
        <extension url="actor">
          <valueCanonical value="http://hl7.org.uk/fhir/ps/ActorDefinition/uk-ps-actor-consumer"/>
        </extension>
      </extension>
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Patient"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-patient"/>
      </type>
      <mustSupport value="true"/>
    </element>
    <element id="Bundle.entry:allergyintolerance">
      <path value="Bundle.entry"/>
      <sliceName value="allergyintolerance"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:allergyintolerance.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="AllergyIntolerance"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-allergyintolerance"/>
      </type>
    </element>
    <element id="Bundle.entry:condition">
      <path value="Bundle.entry"/>
      <sliceName value="condition"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:condition.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Condition"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-condition"/>
      </type>
    </element>
    <element id="Bundle.entry:encounter">
      <path value="Bundle.entry"/>
      <sliceName value="encounter"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:encounter.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Encounter"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-encounter"/>
      </type>
    </element>

    <element id="Bundle.entry:location">
      <path value="Bundle.entry"/>
      <sliceName value="location"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:location.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Location"/>
        <profile value="https://fhir.hl7.org.uk/StructureDefinition/UKCore-Location"/>
      </type>
    </element>
    <element id="Bundle.entry:medication">
      <path value="Bundle.entry"/>
      <sliceName value="medication"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:medication.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Medication"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-medication"/>
      </type>
    </element>
    <element id="Bundle.entry:medicationrequest">
      <path value="Bundle.entry"/>
      <sliceName value="medicationrequest"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:medicationrequest.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="MedicationRequest"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-medicationrequest"/>
      </type>
    </element>
    <element id="Bundle.entry:medicationstatement">
      <path value="Bundle.entry"/>
      <sliceName value="medicationstatement"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:medicationstatement.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="MedicationStatement"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-medicationstatement"/>
      </type>
    </element>
    <element id="Bundle.entry:organization">
      <path value="Bundle.entry"/>
      <sliceName value="organization"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:organization.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Organization"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-organization"/>
      </type>
    </element>
    <element id="Bundle.entry:practitioner">
      <path value="Bundle.entry"/>
      <sliceName value="practitioner"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:practitioner.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="Practitioner"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-practitioner"/>
      </type>
    </element>
    <element id="Bundle.entry:practitionerrole">
      <path value="Bundle.entry"/>
      <sliceName value="practitionerrole"/>
      <min value="0"/>
      <max value="*"/>
    </element>
    <element id="Bundle.entry:practitionerrole.resource">
      <path value="Bundle.entry.resource"/>
      <min value="1"/>
      <type>
        <code value="PractitionerRole"/>
        <profile value="http://hl7.org.uk/fhir/ps/StructureDefinition/uk-ps-practitionerrole"/>
      </type>
    </element>

  </differential>
</StructureDefinition>
